<div class="users">
  <!-- Header -->
  <div class="head">
    <div class="title">
      <div class="icon">
        <lucide-icon [img]="UsersIcon" size="20"></lucide-icon>
      </div>
      <div>
        <h2>Users</h2>
        <p class="sub">Manage users, roles and access</p>
      </div>
    </div>

    <div class="head-actions">
      <!-- ✅ Create -->
      <button class="btn primary" (click)="facade.openCreate()">
        <lucide-icon [img]="PlusIcon" size="16"></lucide-icon>
        Create User
      </button>

      <button class="btn" (click)="facade.load()" [disabled]="facade.loading()">
        <lucide-icon [img]="RefreshIcon" size="16"></lucide-icon>
        Refresh
      </button>
    </div>
  </div>

  <!-- Toolbar -->
  <div class="toolbar card">
    <div class="search">
      <lucide-icon class="search-ic" [img]="SearchIcon" size="16"></lucide-icon>
      <input [value]="facade.q()" (input)="facade.setQuery($any($event.target).value)" (keyup.enter)="facade.search()"
        placeholder="Search by name or email..." />
    </div>

    <div class="meta">
      <span class="badge">{{ facade.rangeText() }}</span>
      <span class="badge">Page {{ facade.page() }} / {{ facade.totalPages() }}</span>
      <button class="btn ghost" (click)="facade.search()" [disabled]="facade.loading()">Search</button>
      <button class="btn ghost" (click)="facade.reset()" [disabled]="facade.loading()">Reset</button>
    </div>
  </div>

  <div class="error" *ngIf="facade.error()">{{ facade.error() }}</div>

  <!-- Table Card -->
  <div class="card table-card">
    <div class="skeleton" *ngIf="facade.loading()">
      <div class="sk-row" *ngFor="let _ of [1,2,3,4,5,6]"></div>
    </div>

    <div class="empty" *ngIf="!facade.loading() && !facade.error() && facade.items().length === 0">
      <div class="empty-ic">
        <lucide-icon [img]="UsersIcon" size="28"></lucide-icon>
      </div>
      <div class="empty-title">No users found</div>
      <div class="empty-sub">Try another keyword or reset the search.</div>
      <button class="btn" (click)="facade.reset()">Reset</button>
    </div>

    <table *ngIf="!facade.loading() && !facade.error() && facade.items().length > 0">
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th style="width: 140px;">Role</th>
          <th class="th-actions" style="width: 120px;">Actions</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let u of facade.items(); trackBy: trackById">
          <td>
            <div class="cell-main">
              <div class="avatar">{{ u.name.slice(0, 1).toUpperCase() }}</div>
              <div class="cell-text">
                <div class="primary-text">{{ u.name }}</div>
                <div class="secondary">{{ u.id }}</div>
              </div>
            </div>
          </td>

          <td class="primary-text">{{ u.email }}</td>

          <td>
            <span class="pill" [class.good]="u.role === 'admin'">
              <lucide-icon [img]="RoleIcon" size="14"></lucide-icon>
              {{ u.role }}
            </span>
          </td>

          <!-- ✅ เพิ่มอันนี้ -->
          <td class="td-actions">
            <button class="icon-btn sm" (click)="facade.openEdit(u)" type="button" title="Edit">

              <lucide-icon [img]="EditIcon" size="16"></lucide-icon>
            </button>

            <button class="icon-btn sm danger" (click)="facade.requestDelete(u)" type="button" title="Delete">
              <lucide-icon [img]="DeleteIcon" size="16"></lucide-icon>
            </button>
          </td>
        </tr>
      </tbody>

    </table>
  </div>

  <!-- Pager -->
  <div class="pager">
    <button class="btn ghost" (click)="facade.prev()" [disabled]="!facade.canPrev()">
      <lucide-icon [img]="PrevIcon" size="16"></lucide-icon>
      Prev
    </button>

    <div class="pager-mid">
      <span class="badge">{{ facade.rangeText() }}</span>
    </div>

    <button class="btn ghost" (click)="facade.next()" [disabled]="!facade.canNext()">
      Next
      <lucide-icon [img]="NextIcon" size="16"></lucide-icon>
    </button>
  </div>

  <app-user-modal [open]="facade.modalOpen()" [mode]="facade.modalMode()" [initial]="facade.editTarget()"
    [saving]="facade.saving()" [error]="facade.formError()" (submit)="facade.submit($event)"
    (closed)="facade.closeModal()" />

</div>